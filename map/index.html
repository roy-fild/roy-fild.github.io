<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>행정구역 지도 뷰어</title>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <style>
    :root{
      --bg:#0b0f19;
      --panel:#111827;
      --panel2:#0f172a;
      --line:#233047;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --accent:#60a5fa;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
      background:linear-gradient(180deg, #060814, #0b1020);
      color:var(--text);
      height:100vh;
      overflow:hidden;
    }

    .app{
      display:grid;
      grid-template-columns: 280px 1fr;
      height:100vh;
    }

    /* LEFT */
    .sidebar{
      background:rgba(17,24,39,.9);
      border-right:1px solid var(--line);
      display:flex;
      flex-direction:column;
      min-width:240px;
    }
    .sidebar header{
      padding:16px 14px;
      border-bottom:1px solid var(--line);
    }
    .title{
      font-size:15px;
      font-weight:700;
      margin:0 0 6px 0;
    }
    .subtitle{
      font-size:12px;
      color:var(--muted);
      margin:0;
      line-height:1.4;
    }
    .search{
      padding:12px 14px;
      border-bottom:1px solid var(--line);
    }
    .search input{
      width:100%;
      padding:10px 10px;
      border-radius:10px;
      border:1px solid #263450;
      background:#0b1224;
      color:var(--text);
      outline:none;
    }

    .district-list{
      padding:10px;
      overflow:auto;
    }
    .district{
      padding:10px 12px;
      border:1px solid transparent;
      border-radius:12px;
      cursor:pointer;
      display:flex;
      gap:10px;
      align-items:center;
      user-select:none;
    }
    .district:hover{
      background:rgba(96,165,250,.08);
      border-color:rgba(96,165,250,.25);
    }
    .district.active{
      background:rgba(96,165,250,.14);
      border-color:rgba(96,165,250,.35);
    }
    .pill{
      font-size:11px;
      color:#c7d2fe;
      background:rgba(99,102,241,.18);
      border:1px solid rgba(99,102,241,.35);
      padding:3px 8px;
      border-radius:999px;
      margin-left:auto;
      white-space:nowrap;
    }

    /* MAIN */
    .main{
      display:flex;
      flex-direction:column;
      height:100%;
    }

    .topbar{
      padding:12px 14px;
      border-bottom:1px solid var(--line);
      background:rgba(15,23,42,.85);
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .topbar .now{
      font-weight:700;
      margin-right:auto;
    }
    .btn{
      padding:9px 10px;
      border-radius:10px;
      border:1px solid #2a3a55;
      background:#0b1224;
      color:var(--text);
      cursor:pointer;
      user-select:none;
      font-size:12px;
    }
    .btn:hover{ border-color:rgba(96,165,250,.55); }
    .hint{
      font-size:12px;
      color:var(--muted);
      margin-left:6px;
    }

    .viewer-wrap{
      flex:1;
      position:relative;
      background:radial-gradient(900px 500px at 40% 30%, rgba(96,165,250,.10), transparent 55%),
                 radial-gradient(900px 500px at 70% 70%, rgba(34,197,94,.08), transparent 55%),
                 rgba(2,6,23,.4);
    }

    /* canvas(드래그/줌 영역) */
    .viewer{
      position:absolute;
      inset:14px;
      border:1px solid var(--line);
      border-radius:16px;
      overflow:hidden;
      background:rgba(2,6,23,.35);
    }

    .stage{
      position:absolute;
      left:0; top:0;
      width:100%;
      height:100%;
      overflow:hidden;
      cursor:grab;
      touch-action: none;
    }
    .stage.dragging{ cursor:grabbing; }

    /* 실제 이미지 */
    #mapImg{
      position:absolute;
      left:0; top:0;
      transform-origin: 0 0;
      will-change: transform;
      user-select:none;
      -webkit-user-drag:none;
      image-rendering:auto;
    }

    .empty{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap:8px;
      color:var(--muted);
      text-align:center;
      padding:18px;
    }
    .empty b{ color:var(--text); }

    /* 작은 상태표시 */
    .status{
      position:absolute;
      right:26px;
      bottom:26px;
      background:rgba(15,23,42,.85);
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px 12px;
      font-size:12px;
      color:var(--muted);
      display:flex;
      gap:10px;
      align-items:center;
      backdrop-filter: blur(6px);
    }
    .status span{ color:var(--text); }
  /* ===== Mobile / Responsive ===== */
.menu-btn{
  display:none;
  align-items:center;
  justify-content:center;
  gap:6px;
  padding:9px 10px;
  border-radius:10px;
  border:1px solid #2a3a55;
  background:#0b1224;
  color:var(--text);
  cursor:pointer;
  user-select:none;
  font-size:12px;
}
.menu-btn:hover{ border-color:rgba(96,165,250,.55); }

.backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  backdrop-filter: blur(2px);
  display:none;
  z-index:40;
}

@media (max-width: 900px){
  body{ height:100dvh; }
  .app{
    grid-template-columns: 1fr;
  }
  .sidebar{
    position:fixed;
    top:0;
    left:0;
    height:100dvh;
    width:min(86vw, 320px);
    transform: translateX(-110%);
    transition: transform .22s ease;
    z-index:50;
    box-shadow: 12px 0 30px rgba(0,0,0,.35);
  }
  .sidebar.open{ transform: translateX(0); }
  .backdrop.show{ display:block; }
  .menu-btn{ display:inline-flex; }
  .viewer{ inset:10px; border-radius:14px; }
  .topbar{ position:sticky; top:0; z-index:10; }
  .hint{ display:none; }
}

@media (max-width: 420px){
  .topbar{ gap:8px; }
  .btn, .menu-btn{ padding:9px 9px; }
  .status{ right:14px; bottom:14px; }
}
  
/* ===== Added wheel-scroll fix ===== */
.sidebar { overflow: hidden !important; }
.district-list {
    flex: 1 1 auto !important;
    min-height: 0 !important;
    overflow-y: auto !important;
}


/* ===== Slim modern scrollbar ===== */
.district-list {
  scrollbar-width: thin;                 /* Firefox */
  scrollbar-color: rgba(0,0,0,0.25) transparent;
}

/* Chrome, Edge, Safari */
.district-list::-webkit-scrollbar {
  width: 6px;
}

.district-list::-webkit-scrollbar-track {
  background: transparent;
}

.district-list::-webkit-scrollbar-thumb {
  background: rgba(0,0,0,0.25);
  border-radius: 10px;
}

.district-list::-webkit-scrollbar-thumb:hover {
  background: rgba(0,0,0,0.4);
}

</style>
</head>

<body>
  <div id="backdrop" class="backdrop"></div>
  <div class="app">
    <!-- LEFT -->
    <aside class="sidebar">
      <header>
        <p class="title">행정구역 선택</p>
        <p class="subtitle">왼쪽에서 구역을 클릭하면 오른쪽에 지도를 띄워요.</p>
      </header>

      <div class="search">
        <input id="q" type="text" placeholder="검색 (예: 인창동, 수택동…)" />
      </div>

      <div id="districtList" class="district-list"></div>
    </aside>

    <!-- MAIN -->
    <main class="main">
      <div class="topbar">
        <button class="menu-btn" id="menuBtn" aria-label="메뉴 열기">☰ 메뉴</button>
        <div class="now">선택됨: <span id="nowName" style="color:var(--accent)">-</span></div>

        <button class="btn" id="zoomOut">- 축소</button>
        <button class="btn" id="zoomIn">+ 확대</button>
        <button class="btn" id="reset">리셋</button>
        <span class="hint">마우스휠=줌, 드래그=이동, 더블클릭=리셋</span>
      </div>

      <div class="viewer-wrap">
        <div class="viewer">
          <div id="stage" class="stage">
            <!-- 실제 이미지 -->
            <img id="mapImg" alt="map" style="display:none;" />
            <div id="empty" class="empty">
              <b>왼쪽에서 행정구역을 선택해줘</b>
              <div>이미지는 Git raw 주소로 연결하면 바로 표시돼요.</div>
            </div>
          </div>
        </div>

        <div class="status">
          스케일 <span id="scaleText">1.00</span>
          · X <span id="xText">0</span>
          · Y <span id="yText">0</span>
        </div>
      </div>
    </main>
  </div>

<script>
$(function(){

  // ✅ 여기에 "행정구역명: 이미지URL" 매핑만 채우면 됨
  // GitHub 예시(반드시 raw URL로):
  // https://raw.githubusercontent.com/<user>/<repo>/main/images/xxx.png
  const districts = {
    "송파구":"http://roy-fild.github.io/map/contents/songpa-gu.png",
    "성동구":"http://roy-fild.github.io/map/contents/seongdong-gu.png",
    "양천구":"http://roy-fild.github.io/map/contents/yangcheon-gu.png",
    "분당구":"http://roy-fild.github.io/map/contents/bundang-gu.png",
    "종로구":"http://roy-fild.github.io/map/contents/jongno-gu.png",
    "중구":"http://roy-fild.github.io/map/contents/jung-gu.png",
    "동작구":"http://roy-fild.github.io/map/contents/dongjak-gu.png",
    "관악구":"http://roy-fild.github.io/map/contents/gwanak-gu.png",
    "은평구": "http://roy-fild.github.io/map/contents/eunpyeong-gu.png",
    "서대문구": "http://roy-fild.github.io/map/contents/seodaemun-gu.png",
    "구로구": "http://roy-fild.github.io/map/contents/guro-gu.png",
    "중랑구": "http://roy-fild.github.io/map/contents/jungnang-gu.png",
    "수원시-영통구": "http://roy-fild.github.io/map/contents/suwon-si-yeongtong-gu.png",
    "안양시-동안구": "http://roy-fild.github.io/map/contents/anyang-si-dongan-gu.png",
    "부천시": "http://roy-fild.github.io/map/contents/bu-cheon.png",
    "구리시": "http://roy-fild.github.io/map/contents/guri-si.png",
    "군포시": "http://roy-fild.github.io/map/contents/gunpo-si.png",
    "부산진구": "http://roy-fild.github.io/map/contents/busanjin-gu.png",
    "대구-수성구": "http://roy-fild.github.io/map/contents/daegu-suseong-gu.png",
    "광주-북구": "http://roy-fild.github.io/map/contents/gwangju-buk-gu..png",
    "포항-북구": "http://roy-fild.github.io/map/contents/pohang-si-buk-gu.png",
    
  };

  // ---- UI: 리스트 렌더 ----
  const $list = $("#districtList");

  function renderList(filterText=""){
    $list.empty();
    const keys = Object.keys(districts);

    const filtered = keys.filter(name => name.includes(filterText));
    if(filtered.length === 0){
      $list.append(`<div style="padding:14px;color:var(--muted);font-size:12px;">검색 결과가 없어요</div>`);
      return;
    }

    filtered.forEach((name, idx) => {
      const html = `
        <div class="district" data-name="${escapeHtml(name)}">
          <div>${escapeHtml(name)}</div>
          <div class="pill">MAP</div>
        </div>`;
      $list.append(html);
    });
  }

  $("#q").on("input", function(){
    renderList($(this).val().trim());
  });

  renderList();

// ---- Mobile: 사이드바 토글 ----
const $sidebar = $(".sidebar");
const $backdrop = $("#backdrop");

function openSidebar(){
  $sidebar.addClass("open");
  $backdrop.addClass("show");
  $("#menuBtn").attr("aria-label", "메뉴 닫기");
}
function closeSidebar(){
  $sidebar.removeClass("open");
  $backdrop.removeClass("show");
  $("#menuBtn").attr("aria-label", "메뉴 열기");
}
function isMobile(){
  return window.matchMedia && window.matchMedia("(max-width: 900px)").matches;
}

$("#menuBtn").on("click", function(){
  if($sidebar.hasClass("open")) closeSidebar();
  else openSidebar();
});
$backdrop.on("click", closeSidebar);

  // ---- 뷰어(줌/드래그) ----
  const $stage = $("#stage");
  const $img   = $("#mapImg");
  const $empty = $("#empty");

  let state = {
    scale: 1,
    x: 0,
    y: 0,
    dragging: false,
    lastX: 0,
    lastY: 0,
    imgNaturalW: 0,
    imgNaturalH: 0,
  };

  function applyTransform(){
    $img.css("transform", `translate(${state.x}px, ${state.y}px) scale(${state.scale})`);
    $("#scaleText").text(state.scale.toFixed(2));
    $("#xText").text(Math.round(state.x));
    $("#yText").text(Math.round(state.y));
  }

  function clampScale(s){
    return Math.max(0.2, Math.min(6, s));
  }

  function resetView(fitToStage=true){
    state.scale = 1;
    state.x = 0;
    state.y = 0;

    if(fitToStage && state.imgNaturalW && state.imgNaturalH){
      const sw = $stage.width();
      const sh = $stage.height();
      const scaleFit = Math.min(sw / state.imgNaturalW, sh / state.imgNaturalH);
      state.scale = clampScale(scaleFit);
      // 중앙 정렬
      state.x = (sw - state.imgNaturalW * state.scale) / 2;
      state.y = (sh - state.imgNaturalH * state.scale) / 2;
    }

    applyTransform();
  }

  function zoomAt(stageX, stageY, deltaScale){
    const oldScale = state.scale;
    const newScale = clampScale(oldScale * deltaScale);
    if(newScale === oldScale) return;

    // 줌 포인트 기준으로 이동 보정
    const wx = (stageX - state.x) / oldScale;
    const wy = (stageY - state.y) / oldScale;

    state.scale = newScale;
    state.x = stageX - wx * newScale;
    state.y = stageY - wy * newScale;

    applyTransform();
  }

  // 드래그 (마우스/터치 공통: Pointer Events)
$stage.on("pointerdown", function(e){
  if($img.is(":hidden")) return;
  // 스크롤/줌 제스처 방지(모바일에서 드래그가 스크롤로 잡히는 것 방지)
  e.preventDefault();

  state.dragging = true;
  state.lastX = e.clientX;
  state.lastY = e.clientY;

  // 포인터 캡처 (손가락이 영역 밖으로 나가도 드래그 유지)
  try { this.setPointerCapture(e.pointerId); } catch(_) {}
  $stage.addClass("dragging");
});

$stage.on("pointermove", function(e){
  if(!state.dragging) return;
  const dx = e.clientX - state.lastX;
  const dy = e.clientY - state.lastY;
  state.lastX = e.clientX;
  state.lastY = e.clientY;
  state.x += dx;
  state.y += dy;
  applyTransform();
});

$stage.on("pointerup pointercancel", function(e){
  state.dragging = false;
  try { this.releasePointerCapture(e.pointerId); } catch(_) {}
  $stage.removeClass("dragging");
});

// 휠 줌
  $stage.on("wheel", function(e){
    if($img.is(":hidden")) return;
    e.preventDefault();
    const rect = $stage[0].getBoundingClientRect();
    const stageX = e.originalEvent.clientX - rect.left;
    const stageY = e.originalEvent.clientY - rect.top;

    const direction = e.originalEvent.deltaY > 0 ? 0.9 : 1.1;
    zoomAt(stageX, stageY, direction);
  });

  // 더블클릭 리셋
  $stage.on("dblclick", function(){
    if($img.is(":hidden")) return;
    resetView(true);
  });

  // 버튼 줌/리셋
  $("#zoomIn").on("click", function(){
    if($img.is(":hidden")) return;
    zoomAt($stage.width()/2, $stage.height()/2, 1.15);
  });
  $("#zoomOut").on("click", function(){
    if($img.is(":hidden")) return;
    zoomAt($stage.width()/2, $stage.height()/2, 0.87);
  });
  $("#reset").on("click", function(){
    if($img.is(":hidden")) return;
    resetView(true);
  });

  // ---- 구역 클릭 시 이미지 로드 ----
  $list.on("click", ".district", function(){
    const name = $(this).data("name");
    const url = districts[name];

    $(".district").removeClass("active");
    $(this).addClass("active");

    $("#nowName").text(name);

    $empty.hide();
    $img.hide().attr("src", url);

    // 로딩 후 자연크기 기반 fit
    $img.off("load").on("load", function(){
      state.imgNaturalW = this.naturalWidth;
      state.imgNaturalH = this.naturalHeight;
      $img.show();
      resetView(true);
    });

    if(isMobile()) closeSidebar();

    $img.off("error").on("error", function(){
      $img.hide();
      $empty.show().html(`
        <b>이미지 로드 실패</b>
        <div style="margin-top:6px;">
          URL이 raw 주소인지 확인해줘요.<br/>
          <span style="color:#cbd5e1;word-break:break-all;">${escapeHtml(url)}</span>
        </div>
      `);
    });
  });

  // 창 리사이즈 시 현재 뷰 fit 재적용(원하면 주석처리)
  $(window).on("resize", function(){
    if($img.is(":hidden")) return;
    resetView(true);
  });

  // 유틸
  function escapeHtml(str){
    return String(str).replace(/[&<>"']/g, s => ({
      "&":"&amp;", "<":"&lt;", ">":"&gt;", '"':"&quot;", "'":"&#39;"
    }[s]));
  }

});
</script>

<script>
/* ===== Pinch Zoom 추가 (모바일 두손가락 확대/축소) ===== */
(function(){
  const viewer = document.querySelector('.viewer-inner');
  if(!viewer) return;

  let pointers = new Map();
  let startDist = 0;
  let startScale = 1;
  let currentScale = 1;

  function getDistance(a,b){
    const dx = a.clientX - b.clientX;
    const dy = a.clientY - b.clientY;
    return Math.sqrt(dx*dx + dy*dy);
  }

  viewer.addEventListener("pointerdown", e=>{
    pointers.set(e.pointerId, e);
  });

  viewer.addEventListener("pointermove", e=>{
    if(!pointers.has(e.pointerId)) return;
    pointers.set(e.pointerId, e);

    if(pointers.size === 2){
      const pts = Array.from(pointers.values());
      const dist = getDistance(pts[0], pts[1]);

      if(!startDist){
        startDist = dist;
        startScale = currentScale;
      }else{
        const scale = (dist / startDist) * startScale;
        currentScale = Math.min(Math.max(scale, 0.5), 4); // 최소/최대 확대 제한
        viewer.style.transform = `scale(${currentScale})`;
      }
    }
  });

  function resetPointer(e){
    pointers.delete(e.pointerId);
    if(pointers.size < 2){
      startDist = 0;
    }
  }

  viewer.addEventListener("pointerup", resetPointer);
  viewer.addEventListener("pointercancel", resetPointer);
  viewer.addEventListener("pointerleave", resetPointer);
})();
</script>


<script>
// ===== Added wheel-scroll forwarding =====
document.addEventListener("DOMContentLoaded", function(){
    const sidebar = document.querySelector(".sidebar");
    const list = document.querySelector(".district-list");
    if(!sidebar || !list) return;

    sidebar.addEventListener("wheel", function(e){
        // if wheel happens over sidebar but not directly scrollable element,
        // forward scroll to the list
        list.scrollTop += e.deltaY;
        e.preventDefault();
    }, { passive:false });
});
</script>

</body>
</html>







